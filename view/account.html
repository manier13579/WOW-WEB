<link rel="stylesheet" type="text/css" href="css/account.css">

<div class="layui-col-m12">
  <div class="layui-card">
    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
      <ul class="layui-tab-title">
        <li class="layui-this">登录</li>
        <li>注册</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
          <form class="layui-form" action="">
            <div class="layui-form-item">
              <label class="layui-form-label">用户名</label>
              <div class="layui-input-block">
                <input type="text" name="userid" required  lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">密码</label>
              <div class="layui-input-inline">
                <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="login">登录</button>
              </div>
            </div>
          </form>
        
        </div>
        <div class="layui-tab-item">
          <form class="layui-form">
            <div class="layui-form-item">
              <label class="layui-form-label">用户名</label>
              <div class="layui-input-inline">
                <input type="text" name="userid" required  lay-verify="required" placeholder="由字母、数字组成，用于登录" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">必填项</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">密码</label>
              <div class="layui-input-inline">
                <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">必填项</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">确认密码</label>
              <div class="layui-input-inline">
                <input type="password" name="password2" required lay-verify="required" placeholder="请再次输入密码" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">必填项</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">昵称</label>
              <div class="layui-input-inline">
                <input type="text" name="username" placeholder="用于社区交流" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">邮箱</label>
              <div class="layui-input-inline">
                <input type="text" name="email" placeholder="用于找回密码" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">手机号</label>
              <div class="layui-input-inline">
                <input type="text" name="phone" placeholder="用于找回密码" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="reg">注册</button>
              </div>
            </div>
          </form>
        
        </div>
      </div>
    </div>      
  </div>
</div>

<script>
layui.use('form', function(){
  var form = layui.form;
  
  //监听提交
  form.on('submit(reg)', function(data){
    if(data.field.password == data.field.password2){
      ajax = $.ajax({
        url:rootpath+"/controller/register_controller.php",
        async:false,
        type: 'post',
        data: {"regData":data.field},
        success:function(res){
          res = JSON.parse(res);
          console.log(res.code);
          if(res.code==0){
            sessionStorage.access_token = res.data.access_token;
            sessionStorage.userid = res.data.userid;
            sessionStorage.username = res.data.username;
            sessionStorage.role = res.data.role;
            sessionStorage.joindate = res.data.joindate;
            window.location.href = rootpath+"/";
          }else{
            layer.msg(res, {
              icon: 3,
              time: 1500 //1.5秒关闭
            }, function(){
              //$('input[name="username"]').val('');
              //$('input[name="password"]').val('');
            });
          }
        },
        error:function (e) {
          layer.msg(e.responseJSON.ExceptionMessage, {
            icon: 3,
            time: 1500 //1.5秒关闭
          }, function(){
            //$('input[name="username"]').val('');
            //$('input[name="password"]').val('');
          });
        }
      });
    }else{
      layer.msg("2次输入的密码不一致", {
        icon: 3,
        time: 1500 //1.5秒关闭
      });
    }
    return false;
    
  });
});
</script>